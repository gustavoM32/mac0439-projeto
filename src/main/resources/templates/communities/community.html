<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Comunidade</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" href="/style.css">
  <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"></script>
 <script type="text/javascript" src="/js/community.js"></script>
</head>
<body>
<div class="box">
  <h1 th:text="|Comunidade / ${community.name}|">Comunidade</h1>

  <p class="replace-nl" th:text="${community.description}">Descrição</p>
  <p th:utext="|Criada por ${community.creator} em ${#temporals.format(community.creationDate, 'dd/MM/yyyy, HH:mm', 'pt_BR')}|">Criado por alguém em 00/00/0000, 00:00</p>

  <a th:href="@{/communities/{cid}/edit-community(cid=${community.id})}">
    <button>Editar informações</button>
  </a>

  <a href="/communities"><button>Voltar</button></a>

  <button th:onclick="deleteCommunity(this.dataset)"
          th:data-cid="${community.id}">Remover comunidade</button>

  <div class="box">
    <h2>Publicações</h2>
    <a th:href="@{/communities/{cid}/add-publication(cid=${community.id})}">
      <button>Adicionar publicação</button>
    </a>

    <div class="box" th:each="p : ${community.publications}">

      <b><p th:text="${p.title}">Título</p></b>
      <p class="replace-nl" th:text="${p.text}">Texto</p>
      <p th:text="|Publicado por ${p.author} em ${#temporals.format(p.creationDate, 'dd/MM/yyyy, HH:mm', 'pt_BR')}|">Publicado por alguém em 00/00/0000, 00:00</p>

      <a th:href="@{/communities/{cid}/publications/{pid}/edit-publication(cid=${community.id},pid=${p.id})}">
        <button>Editar publicação</button>
      </a>
      <button th:onclick="deletePublication(this.dataset)"
              th:data-cid="${community.id}"
              th:data-pid="${p.id}">Remover publicação</button>

      <div class="box">
        <h3>Comentários</h3>
        <a th:href="|/communities/${community.id}/publications/${p.id}/add-comment|"><button>Adicionar comentário</button></a>

        <div class="box" th:each="c : ${p.comments}">
          <p th:text="${c.author}">Autor</p>
          <p class="replace-nl" th:text="${c.text}">Texto</p>
          <p th:text="${#temporals.format(c.creationDate, 'dd/MM/yyyy, HH:mm', 'pt_BR')}">Data</p>
          <p th:if="${c.likes}" th:text="|Curtidas: ${c.likes.size}|">Curtidas: 10</p>
          <p th:unless="${c.likes}">Curtidas: 0</p>

          <button type="button"
                  th:onclick="deleteComment(this.dataset)"
                  th:data-cid="${community.id}"
                  th:data-pid="${p.id}"
                  th:data-cmid="${c.id}">Remover comentário</button>
          <form action="#" th:action="@{/communities/{cid}/publications/{pid}/comments/{cmid}(cid=${community.id},pid=${p.id},cmid=${c.id})}" method="post">
            <button th:if="${c.likes != null and not #arrays.contains(c.likes, currentUser)}"
                    type="submit" name="like" value="add">Curtir</button>
            <button th:unless="${c.likes != null and not #arrays.contains(c.likes, currentUser)}"
                    type="submit" name="like" value="remove">Descurtir</button>
          </form>
        </div>
      </div>
    </div>
  </div>
<!---->
  <div class="box">
    <h2>Projetos</h2>
    <div class="box" th:each="p : ${community.projects}">
      <p th:text="${p.name}">Projeto</p>
    </div>
  </div>

  <div class="box">
    <h2>Membros</h2>
    <div class="box" th:each="m : ${community.members}">
      <p th:text="${m.id}">Membro</p>
      <p th:text="|Entrou em ${#temporals.format(m.entryDate, 'dd/MM/yyyy, HH:mm', 'pt_BR')}|">Data de entrada</p>
    </div>
  </div>

  <div class="box">
    <h2>Eventos</h2>
    <div class="box" th:each="e : ${community.events}">
      <b><p th:text="${e.title}">Título</p></b>
      <p th:text="|Estado: ${eventStatus.getOrDefault(e.status, 'indefinido')}|">Estado: indefinido</p>
      <p th:text="${e.description}">Descrição</p>
      <p th:text="|Criado por ${e.creator}|">Criado por alguma coisa</p>
      <p th:text="|Agendado para ${#temporals.format(e.date, 'dd/MM/yyyy, HH:mm', 'pt_BR')}, com duração estimada de ${e.estimatedDuration}|">Agendado para 00/00/0000 às 00:00, com duração estimada de 0 horas</p>
      <div class="box">
        <h3>Notas</h3>
        <div th:each="n : ${e.notes}">
          <p th:text="${n}">Nota</p>
        </div>
      </div>
      <div class="box">
        <h3>Participantes</h3>
        <div th:each="v : ${e.participants}">
          <p th:if="${v.confirmationDate}" th:text="|${v.id} confirmado em ${#temporals.format(v.confirmationDate, 'dd/MM/yyyy, HH:mm', 'pt_BR')}|">Participante confirmado em 00/00/0000 às 00:00</p>
          <p th:unless="${v.confirmationDate}" th:text="|${v.id} não confirmado|">Participante não confirmado</p>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
